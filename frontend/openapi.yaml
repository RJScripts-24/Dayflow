openapi: 3.0.3
info:
  title: Dayflow Payroll & HR API
  version: 1.0.0
  description: |
    OpenAPI contract for Dayflow backend. All endpoints (except /api/auth/register and /api/auth/login) require Bearer JWT authentication.
servers:
  - url: http://localhost:5000
paths:
  /api/auth/register:
    post:
      summary: Register a new user (employee, hr, or admin)
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                role:
                  type: string
                  enum: [admin, hr, employee]
                  default: employee
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  token:
                    type: string
                  user:
                    type: object
                    properties:
                      id: { type: string }
                      name: { type: string }
                      email: { type: string }
                      role: { type: string }
  /api/auth/login:
    post:
      summary: Login
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  token: { type: string }
                  user: { type: object }
  /api/auth/me:
    get:
      summary: Get current user
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User info
          content:
            application/json:
              schema:
                type: object
  /api/auth/change-password:
    put:
      summary: Change password
      tags: [Auth]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                oldPassword: { type: string }
                newPassword: { type: string }
      responses:
        '200':
          description: Password updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
  /api/emp:
    get:
      summary: Get all employees
      tags: [Employee]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of employees
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
    post:
      summary: Create employee
      tags: [Employee]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName: { type: string }
                lastName: { type: string }
                email: { type: string, format: email }
                role: { type: string, enum: [employee, hr, admin] }
                department: { type: string }
                designation: { type: string }
                wage: { type: number }
                joinDate: { type: string, format: date }
      responses:
        '201':
          description: Employee created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  employee: { type: object }
                  temporaryPassword: { type: string }
  /api/emp/{id}:
    get:
      summary: Get employee by ID
      tags: [Employee]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Employee info
          content:
            application/json:
              schema:
                type: object
    put:
      summary: Update employee
      tags: [Employee]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Employee updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
    delete:
      summary: Delete employee
      tags: [Employee]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Employee deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
  /api/emp/profile:
    get:
      summary: Get current employee profile
      tags: [Employee]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile info
          content:
            application/json:
              schema:
                type: object
  /api/emp/attendance:
    post:
      summary: Mark attendance (check-in/check-out)
      tags: [Employee]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Attendance marked
          content:
            application/json:
              schema:
                type: object
  /api/emp/attendance/history:
    get:
      summary: Get attendance history
      tags: [Employee]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: month
          schema:
            type: integer
        - in: query
          name: year
          schema:
            type: integer
      responses:
        '200':
          description: Attendance history
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
  /api/emp/leave:
    post:
      summary: Apply for leave
      tags: [Employee]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                leaveType: { type: string }
                startDate: { type: string, format: date }
                endDate: { type: string, format: date }
                reason: { type: string }
      responses:
        '201':
          description: Leave request submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  leaveId: { type: integer }
  /api/payroll:
    get:
      summary: Get all payrolls
      tags: [Payroll]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: month
          schema:
            type: integer
        - in: query
          name: year
          schema:
            type: integer
      responses:
        '200':
          description: Payroll records
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
    post:
      summary: Process payroll
      tags: [Payroll]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                month: { type: integer }
                year: { type: integer }
      responses:
        '200':
          description: Payroll processed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  results: { type: array, items: { type: object } }
  /api/payroll/employee/{employeeId}:
    get:
      summary: Get payroll by employee
      tags: [Payroll]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: employeeId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Payroll records
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
  /api/payroll/{id}/status:
    put:
      summary: Update payment status
      tags: [Payroll]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status: { type: string, enum: [Paid, Processed] }
                paymentDate: { type: string, format: date }
      responses:
        '200':
          description: Payment status updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  status: { type: string }
  /api/admin/stats:
    get:
      summary: Get system stats
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: System stats
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalUsers: { type: integer }
                  totalLeaves: { type: integer }
                  pendingLeaves: { type: integer }
  /api/admin/users:
    get:
      summary: Get all users
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
  /api/admin/users/{id}:
    delete:
      summary: Delete user
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
  /api/admin/leave/{id}:
    put:
      summary: Approve or reject leave
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status: { type: string, enum: [Approved, Rejected] }
                adminResponse: { type: string }
      responses:
        '200':
          description: Leave status updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  data: { type: object }
  /api/admin/rooms:
    get:
      summary: Get all rooms (placeholder)
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Not implemented
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  rooms: { type: array, items: { type: object } }
  /api/admin/rooms/{roomId}:
    delete:
      summary: Delete room (placeholder)
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: roomId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Not implemented
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
